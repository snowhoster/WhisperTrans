# Whisper 模型自動下載功能

## 功能概述

WhisperTrans 現在支援自動下載 Whisper 模型檔案，無需手動從網站下載。

## 支援的模型

系統支援以下 Whisper 模型的自動下載：

| 模型名稱 | 大小 | 說明 | 推薦用途 |
|---------|------|------|---------|
| ggml-tiny.bin | 75 MB | 最小模型，速度最快 | 測試、低配置電腦 |
| ggml-base.bin | 142 MB | 基礎模型 | 一般日常使用（推薦） |
| ggml-small.bin | 466 MB | 小型模型 | 需要較好精確度 |
| ggml-medium.bin | 1464 MB | 中型模型 | 專業使用 |
| ggml-large-v3.bin | 2950 MB | 大型模型 | 最高精確度需求 |

## 使用方式

### 桌面應用程式 (WhisperTrans.Desktop)

#### 方法 1：初始化時自動下載

1. 啟動應用程式
2. 在「模型路徑」欄位輸入想要的模型路徑（例如：`models/ggml-base.bin`）
3. 點擊「初始化」按鈕
4. 如果模型檔案不存在，系統會詢問是否自動下載
5. 點擊「是」開始下載
6. 等待下載完成後，系統會自動繼續初始化

#### 方法 2：使用下載模型按鈕

1. 點擊「下載模型...」按鈕
2. 在彈出的對話框中選擇要下載的模型
3. 選擇儲存位置（預設：`models` 目錄）
4. 點擊「下載」按鈕
5. 等待下載完成
6. 模型路徑會自動更新到對應的檔案

### 命令列應用程式 (WhisperTrans.Console)

1. 啟動程式
2. 輸入模型路徑或按 Enter 使用預設路徑
3. 如果模型檔案不存在，系統會詢問是否自動下載
4. 輸入 `Y` 或 `YES` 確認下載
5. 等待下載完成

## 下載來源

模型檔案從 Hugging Face 官方儲存庫下載：
- 儲存庫：https://huggingface.co/ggerganov/whisper.cpp
- 這是 Whisper.cpp 專案的官方模型儲存位置

## 技術細節

### ModelDownloader 類別

位於 `WhisperTrans.Core.Services.ModelDownloader`

主要方法：
- `DownloadModelAsync()` - 下載指定的模型檔案
- `EnsureModelExistsAsync()` - 檢查模型是否存在，不存在則自動下載
- `GetAvailableModels()` - 取得支援的模型列表
- `GetEstimatedModelSize()` - 取得模型的預估大小

### 進度回報

下載過程中會即時回報進度：
- 下載百分比（0-100%）
- 已下載大小 / 總大小（MB）
- 目前狀態訊息

### 錯誤處理

如果自動下載失敗，系統會：
1. 顯示錯誤訊息
2. 提供手動下載的指引
3. 提供官方下載連結

## 注意事項

1. **網路連線**：下載模型需要穩定的網路連線
2. **下載時間**：大型模型（如 large-v3）可能需要較長時間下載
3. **磁碟空間**：請確保有足夠的磁碟空間儲存模型檔案
4. **防火牆**：某些防火牆可能阻擋下載，請確認允許應用程式存取網路
5. **逾時設定**：下載逾時設定為 30 分鐘，適用於大型模型

## 範例

### 使用預設模型（base）

```csharp
var downloader = new ModelDownloader();
var modelPath = "models/ggml-base.bin";

var progress = new Progress<DownloadProgress>(p =>
{
    Console.WriteLine(p.FormattedMessage);
});

await downloader.EnsureModelExistsAsync(modelPath, progress);
```

### 下載特定模型

```csharp
var downloader = new ModelDownloader();
await downloader.DownloadModelAsync(
    "ggml-small.bin", 
    "models/ggml-small.bin", 
    progress);
```

## 常見問題

### Q: 可以同時下載多個模型嗎？
A: 建議一次下載一個模型，避免網路頻寬問題。

### Q: 下載的模型儲存在哪裡？
A: 預設儲存在應用程式目錄下的 `models` 資料夾，可以自行指定路徑。

### Q: 如何選擇適合的模型？
A: 
- 一般使用：**ggml-base.bin**（推薦）
- 快速測試：ggml-tiny.bin
- 高精確度：ggml-small.bin 或 ggml-medium.bin
- 專業用途：ggml-large-v3.bin

### Q: 下載失敗怎麼辦？
A: 
1. 檢查網路連線
2. 確認防火牆設定
3. 嘗試手動下載：https://huggingface.co/ggerganov/whisper.cpp
4. 將下載的檔案放到 `models` 目錄

## 更新日誌

### v1.0.0
- ? 新增自動下載模型功能
- ? 支援 7 種不同大小的模型
- ? 即時下載進度顯示
- ? 桌面應用程式新增「下載模型」按鈕
- ? 命令列應用程式整合自動下載
