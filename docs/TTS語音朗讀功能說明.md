# Text-to-Speech (TTS) 語音朗讀功能說明

## 功能概述

WhisperTrans v1.3.0 新增了 Text-to-Speech (文字轉語音) 功能，讓您可以：

? **自動朗讀翻譯結果** - 翻譯完成後自動朗讀  
? **手動朗讀轉錄文字** - 點擊按鈕朗讀原文  
? **手動朗讀翻譯文字** - 點擊按鈕朗讀譯文  
? **多語言支援** - 支援繁中、簡中、英文、日文、韓文等  
? **完全免費** - 使用 Windows 內建 TTS 引擎  
? **即時控制** - 隨時停止、暫停、繼續朗讀  

## UI 界面

### 語音朗讀控制區

位於右側翻譯區域下方：

```
┌────────────────────────────────┐
│ ?? 語音朗讀                     │
├────────────────────────────────┤
│ ? 啟用自動朗讀翻譯              │
│                                │
│ ┌──────────┐ ┌──────────┐     │
│ │??朗讀轉錄│ │??朗讀翻譯│     │
│ └──────────┘ └──────────┘     │
│                                │
│ ┌──────────────────────┐       │
│ │   ?? 停止朗讀         │       │
│ └──────────────────────┘       │
└────────────────────────────────┘
```

### 控制項說明

| 控制項 | 功能 | 說明 |
|--------|------|------|
| **? 啟用自動朗讀翻譯** | 自動朗讀開關 | 勾選後，每次翻譯完成會自動朗讀譯文 |
| **?? 朗讀轉錄** | 手動朗讀按鈕 | 朗讀左側轉錄文字框的內容 |
| **?? 朗讀翻譯** | 手動朗讀按鈕 | 朗讀右側翻譯文字框的內容 |
| **?? 停止朗讀** | 停止按鈕 | 立即停止目前的朗讀 |

## 使用方式

### 方式 1: 自動朗讀（推薦）

**步驟：**
1. 設定 LLM 翻譯（vLLM 或 OpenAI 等）
2. 勾選「? 啟用自動朗讀翻譯」
3. 開始錄音和轉錄
4. 系統會自動：
   - 轉錄語音 → 翻譯文字 → **朗讀譯文**

**範例流程：**
```
您說: "Hello, how are you?"
  ↓
系統轉錄: "Hello, how are you?"
  ↓
系統翻譯: "你好，你好嗎？"
  ↓
系統朗讀: "你好，你好嗎？" ??
```

### 方式 2: 手動朗讀轉錄

**步驟：**
1. 錄音並轉錄語音
2. 點擊「?? 朗讀轉錄」按鈕
3. 系統朗讀左側轉錄框的文字

**適用場景：**
- 檢查轉錄準確性
- 語言學習練習
- 確認發音

### 方式 3: 手動朗讀翻譯

**步驟：**
1. 完成轉錄和翻譯
2. 點擊「?? 朗讀翻譯」按鈕
3. 系統朗讀右側翻譯框的文字

**適用場景：**
- 學習目標語言發音
- 確認翻譯內容
- 多次重聽

## 語音引擎

### Windows TTS (內建)

**優點：**
- ? 完全免費
- ? 內建於 Windows
- ? 無需額外設定
- ? 支援多種語言
- ? 離線可用

**支援語言：**

| 語言 | Windows 語音 | 品質 |
|------|-------------|------|
| 繁體中文 | Microsoft Hanhan Desktop | ??? |
| 簡體中文 | Microsoft Huihui Desktop | ??? |
| 英文 | Microsoft Zira Desktop | ???? |
| 日文 | Microsoft Haruka Desktop | ??? |
| 韓文 | Microsoft Heami Desktop | ??? |

**安裝額外語音：**

1. 開啟「設定」→「時間與語言」→「語音」
2. 點擊「管理語音」
3. 點擊「新增語音」
4. 選擇想要的語言
5. 下載並安裝

### 自動語音選擇

系統會根據翻譯目標語言自動選擇合適的語音：

```csharp
翻譯成繁體中文 → Microsoft Hanhan Desktop
翻譯成英文 → Microsoft Zira Desktop
翻譯成日文 → Microsoft Haruka Desktop
```

## 完整使用範例

### 範例 1: 英中翻譯+自動朗讀

**設定：**
```
左側（Whisper）:
- 語言: 英文
- 模型: ggml-base.bin

右側（翻譯）:
- LLM 提供商: 本地模型 (vLLM)
- 翻譯成: 繁體中文
- ? 啟用即時翻譯
- ? 啟用自動朗讀翻譯
```

**工作流程：**
```
1. 開始錄音
2. 您說: "Good morning, everyone!"
3. 左側顯示: "Good morning, everyone!"
4. 右側顯示: "大家早安！"
5. 系統朗讀: "大家早安！" ??
```

### 範例 2: 會議記錄+手動回聽

**設定：**
```
左側（Whisper）:
- 語言: 繁體中文

右側（翻譯）:
- LLM 提供商: 本地模型 (vLLM)
- 翻譯成: 英文
- ? 啟用即時翻譯
- ? 啟用自動朗讀翻譯 (不勾選)
```

**工作流程：**
```
1. 錄製整個會議
2. 會議結束後
3. 點擊「?? 朗讀轉錄」- 回聽中文記錄
4. 點擊「?? 朗讀翻譯」- 回聽英文翻譯
5. 隨時點擊「?? 停止朗讀」
```

### 範例 3: 語言學習

**設定：**
```
左側（Whisper）:
- 語言: 英文

右側（翻譯）:
- 翻譯成: 繁體中文
- ? 啟用自動朗讀 (不勾選)
```

**學習流程：**
```
1. 播放英文教材錄音
2. 系統轉錄英文
3. 系統翻譯成中文
4. 點擊「?? 朗讀轉錄」- 聽英文發音
5. 點擊「?? 朗讀翻譯」- 聽中文意思
6. 重複練習
```

## 技術細節

### 語音參數

| 參數 | 預設值 | 範圍 | 說明 |
|------|--------|------|------|
| **語速 (Rate)** | 1.0 | 0.5-2.0 | 1.0 = 正常速度 |
| **音量 (Volume)** | 0.8 | 0.0-1.0 | 0.8 = 80% 音量 |
| **語音** | 自動 | - | 根據目標語言自動選擇 |

### API 介面

```csharp
public interface ITextToSpeechService
{
    // 是否正在播放
    bool IsSpeaking { get; }

    // 取得可用語音列表
    Task<IEnumerable<VoiceInfo>> GetAvailableVoicesAsync();

    // 設定語音
    void SetVoice(string voiceId);

    // 設定語速 (0.5 - 2.0)
    void SetRate(double rate);

    // 設定音量 (0.0 - 1.0)
    void SetVolume(double volume);

    // 朗讀文字
    Task SpeakAsync(string text, CancellationToken cancellationToken = default);

    // 停止朗讀
    void Stop();

    // 暫停朗讀
    void Pause();

    // 繼續朗讀
    void Resume();
}
```

### 實作類別

```csharp
public class WindowsTtsService : ITextToSpeechService
{
    private readonly SpeechSynthesizer _synthesizer;

    public WindowsTtsService()
    {
        _synthesizer = new SpeechSynthesizer();
        _synthesizer.SetOutputToDefaultAudioDevice();
    }

    // ... 實作方法
}
```

## 進階功能

### 自訂語速和音量（未來版本）

```csharp
// 設定更快的語速
_ttsService.SetRate(1.5);  // 1.5倍速

// 設定更大的音量
_ttsService.SetVolume(1.0);  // 100% 音量
```

### 查詢可用語音

```csharp
var voices = await _ttsService.GetAvailableVoicesAsync();
foreach (var voice in voices)
{
    Console.WriteLine($"{voice.Name} - {voice.Language}");
}
```

## 常見問題

### Q1: 沒有聲音？

**A**: 檢查：
1. Windows 音量是否靜音
2. 音訊輸出裝置是否正確
3. Windows 語音設定是否正常

**測試：**
```
1. 開啟 Windows 設定
2. 時間與語言 → 語音
3. 點擊「試聽」測試 TTS
```

### Q2: 語音不自然？

**A**: Windows 內建 TTS 品質有限。未來版本將支援：
- Azure Cognitive Services TTS（高品質）
- Google Cloud TTS（高品質）
- Edge TTS（免費高品質）

### Q3: 如何安裝其他語音？

**A**: 
1. 開啟「設定」
2. 「時間與語言」→「語音」
3. 「管理語音」
4. 「新增語音」
5. 選擇並下載

**推薦語音包：**
- 繁體中文: Microsoft Hanhan Desktop
- 簡體中文: Microsoft Huihui Desktop
- 英文: Microsoft Zira Desktop

### Q4: 可以調整語速嗎？

**A**: 目前版本使用預設語速 (1.0)。
未來版本將在 UI 中添加語速控制滑桿。

**手動調整（開發者）：**
```csharp
_ttsService.SetRate(1.5);  // 加快到 1.5 倍速
```

### Q5: 朗讀時可以錄音嗎？

**A**: 可以！TTS 和語音轉錄是獨立的。
建議使用耳機避免 TTS 聲音被麥克風錄進去。

### Q6: 自動朗讀會影響效能嗎？

**A**: 影響很小。TTS 是非同步執行，不會阻塞翻譯流程。

### Q7: 可以同時朗讀轉錄和翻譯嗎？

**A**: 不建議。會造成聲音重疊。
請使用「停止朗讀」後再朗讀另一個。

## 效能與資源使用

### 記憶體使用

| 項目 | 記憶體 |
|------|--------|
| Windows TTS 引擎 | ~10-20 MB |
| 語音緩存 | ~1-5 MB |
| **總計** | ~15-25 MB |

### CPU 使用

| 狀態 | CPU 使用率 |
|------|-----------|
| 待機 | < 1% |
| 朗讀中 | 5-10% |

### 延遲

| 項目 | 時間 |
|------|------|
| 啟動延遲 | < 100 ms |
| 朗讀延遲 | < 200 ms |
| 停止回應 | < 50 ms |

## 最佳實踐

### DO ?

```csharp
// 1. 使用自動朗讀for效率
勾選「啟用自動朗讀翻譯」

// 2. 及時停止不需要的朗讀
點擊「停止朗讀」

// 3. 檢查 Windows 語音設定
確保已安裝目標語言語音包
```

### DON'T ?

```csharp
// 1. 不要在沒有耳機時開啟自動朗讀
// 可能導致 TTS 聲音被麥克風錄進去

// 2. 不要同時朗讀多個文字
// 會造成聲音重疊混亂

// 3. 不要期待完美的語音品質
// Windows 內建 TTS 品質有限
```

## 未來計劃

### v1.4.0 計劃新增

? **Edge TTS 支援** - 免費高品質 Neural 語音  
? **語速控制** - UI 滑桿調整語速  
? **音量控制** - UI 滑桿調整音量  
? **語音選擇** - 手動選擇喜歡的語音  
? **SSML 支援** - 更精細的語音控制  

### v1.5.0 計劃新增

? **Azure TTS** - 最高品質的 Neural 語音  
? **Google Cloud TTS** - 多種自然語音  
? **自動斷句** - 智能斷句朗讀長文  
? **情感控制** - 調整語氣和情感  

## 相關資源

- [Windows Speech SDK 文件](https://docs.microsoft.com/zh-tw/dotnet/api/system.speech.synthesis)
- [System.Speech NuGet](https://www.nuget.org/packages/System.Speech/)
- [快速使用指南](./快速使用指南.md)
- [LLM 翻譯功能說明](./LLM翻譯功能說明.md)

## 快速參考

### 快捷操作

| 動作 | 操作 |
|------|------|
| 自動朗讀翻譯 | 勾選「啟用自動朗讀翻譯」 |
| 朗讀原文 | 點擊「?? 朗讀轉錄」 |
| 朗讀譯文 | 點擊「?? 朗讀翻譯」 |
| 停止 | 點擊「?? 停止朗讀」 |

### 支援語言

| 語言 | 語音引擎 | 品質 | 推薦 |
|------|---------|------|------|
| 繁體中文 | Hanhan | ??? | ? |
| 簡體中文 | Huihui | ??? | ? |
| 英文 | Zira | ???? | ? |
| 日文 | Haruka | ??? | ? |
| 韓文 | Heami | ??? | ? |

---

**版本**: 1.3.0  
**最後更新**: 2024  
**狀態**: ? 已實作
